fun model, action ->
    case action
    | AddTodo =>
      let (buffer, todos) = model in
      (buffer, (buffer, false) :: todos)
    | RemoveTodo(idx) =>
      let (_, todos) = model in
      (_, List.remove(todos, idx))
    | ToggleTodo(idx) =>
      let (buffer, todos) = model in
      (buffer, List.update(todos, idx, fun (text, done) -> (text, not done)))
    | UpdateBuffer(b) =>
      let (_, todos) = model in
      (b, todos)
    end
