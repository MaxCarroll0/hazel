fun (buffer, todos), action ->
  case action
  | AddTodo => if buffer $!= "" then (buffer, (buffer, false)::todos) else (buffer, todos)
  | RemoveTodo(idx) => (buffer, List.remove(idx, todos))
  | ToggleTodo(idx) => (buffer, List.mapi(fun (i, (description, completed)) -> if i == idx then (description, !completed) else (description, completed), List.mapi(fun idx, todo -> (idx, todo), todos)))
  | UpdateBuffer(new_buffer) => (new_buffer, todos)
  end