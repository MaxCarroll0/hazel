fun model, action ->
  case action
    | AddTodo => let buffer, todos = model in (buffer, (buffer, false)::todos)
    | RemoveTodo(index) => let buffer, todos = model in (buffer, List.take(index, todos) @ List.drop(index + 1, todos))
    | ToggleTodo(index) => let buffer, todos = model in (buffer, List.mapi((fun i, (text, is_complete) -> if i == index then (text, !is_complete) else (text, is_complete)), todos))
    | UpdateBuffer(new_buffer) => let _, todos = model in (new_buffer, todos)
  end