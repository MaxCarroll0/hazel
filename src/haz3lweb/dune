(include_subdirs unqualified)

(alias
 (name default)
 (deps
  (source_tree www)))

(library
 (name haz3lweb)
 (modules
  (((:standard \ Main)
    \
    Worker)
   \
   SchoolSerde)
  \
  SchoolData)
 (libraries
  incr_dom
  virtual_dom.input_widgets
  util
  ppx_yojson_conv.expander
  haz3lcore
  haz3lschooldata
  pretty
  lwt
  lwtutil)
 (js_of_ocaml
  (flags
   (:include js-of-ocaml-flags-%{profile})))
 (preprocess
  (pps
   ppx_yojson_conv
   js_of_ocaml-ppx
   ppx_let
   ppx_sexp_conv
   ppx_deriving.show)))

(library
 (name haz3lschooldata)
 (modules SchoolData)
 (libraries util ppx_yojson_conv.expander haz3lcore pretty lwt lwtutil)
 (preprocess
  (pps ppx_yojson_conv ppx_let ppx_sexp_conv ppx_deriving.show)))

(executable
 (name main)
 (modules Main)
 (libraries ppx_yojson_conv.expander haz3lweb)
 (modes js)
 (js_of_ocaml
  (flags
   (:include js-of-ocaml-flags-%{profile})))
 (preprocess
  (pps
   ppx_yojson_conv
   js_of_ocaml-ppx
   ppx_let
   ppx_sexp_conv
   ppx_deriving.show)))

(executable
 (name worker)
 (modules Worker)
 (libraries haz3lweb)
 (modes js)
 (preprocess
  (pps js_of_ocaml-ppx)))

; (executable
;  (name haz3lschoolserde)
;  (modules SchoolSerde)
;  (libraries ppx_yojson_conv.expander haz3lcore haz3lschooldata)
;  (preprocess
;   (pps ppx_yojson_conv ppx_let ppx_sexp_conv ppx_deriving.show)))

(env
 (dev
  (js_of_ocaml
   (flags (:standard))))
 (release
  (js_of_ocaml
   (flags (:standard)))))

(rule
 (write-file js-of-ocaml-flags-dev "(:standard)"))

(rule
 (write-file js-of-ocaml-flags-release "(:standard)"))
